var browser = exports;
var h = browser.history = {};

browser.getUrl = function () {
    return location.pathname + location.search + location.hash;
}

browser.navigate = function (url) {
    pushState(url);
    browser.onnavigate();
}

h._state = null;

h.start = function () {
    window.onpopstate = function (evt) {
        h._state = evt.state;
        browser.onnavigate();
    }
}

h.setState = function (state) {
    h._state = state;
    replaceState();
}

h.setState(history.state);

h.pushState = function (state) {
    h._state = state;
    pushState();
}

h.getState = function () {
    return h._state;
}

function pushState (url) {
    history.pushState(h._state, window.title, url);
}

function replaceState () {
    history.replaceState(h._state, window.title);
}

// function resolveUrl (url) {
//     return pathResolveRelative(location.pathname, url);
// }
// 
// function pathResolveRelative (from, to) {
//     if (to.charAt(0) == '/')
//         return to;
// 
//     var path = from.split('/').filter(function (seg, index) {
//         return !(seg == '' && index != 0);
//     });
// 
//     var segs = to.split('/');
//     segs.forEach(function (seg) {
//         if (seg == '.') return;
//         if (seg == '..') {
//             path.pop();
//             return;
//         }
//         path.push(seg);
//     });
//     return path.join('/');
// }
