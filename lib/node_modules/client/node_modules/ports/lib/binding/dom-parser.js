module.exports = function domParser (visit) {
    return function parseElement (el) {
        var spec = el.getAttribute('data-ports');
        if (!spec) return;

        parse(spec).forEach(function (p) {
            visit(el, p);
        });
    }
}

function parse (spec) {
    return spec.split(/,/g).map(function (binding) {
        var b = binding.split(/:/g);

        var port = b[0].split(/\-/);
        var type = port[0];
        var param = port[1];

        var path = b[1].trim().split(/\|/g);
        var filters = path.slice(1);
        path = path[0];

        return {
            type: type, 
            param: param, 
            path: path, 
            filters: filters
        }
    });
}
