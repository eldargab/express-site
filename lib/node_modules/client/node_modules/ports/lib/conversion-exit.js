var P = require('./port');

module.exports = function (output, input) {
    output = output || passThrough;
    input = input || passThrough;

    return function filter (port) {
        function setter (val) {
            try {
                val = input(val);
            }
            catch (e) {
                return;
            }
            port(val);
        }

        function getter () {
            return output(port()); 
        }

        if (!port.addListener) return P.create(setter, getter);

        var ret = P.createListenable(setter, getter);

        port.addListener(function () {
            ret.onchange();
        });

        return ret;
    }
}

function passThrough (val) {
    return val;
}
