var P = require('./port');

module.exports = function (output, input) {
    output = output || passThrough;
    input = input || passThrough;

    return function filter (port) {
        function setter (val) {
            try {
                val = input(val);
            }
            catch (e) {
                return;
            }
            port(val);
        }

        function getter () {
            return output(port()); 
        }

        if (port.listen) {
            var events = Object.create(Backbone.Events);
            port.listen(events.trigger.bind(events, 'change'));
            return P.createListenable(setter, getter, events);
        }
        return P.create(setter, getter);
    }
}

function passThrough (val) {
    return val;
}
