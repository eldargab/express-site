var Page = require('./page');
var browser = require('browser');

module.exports = Site;

function Site (container) {
    this.el = container;
    this.pages = {};
    
    var pageContainer = $(this.el).children()[0];
    if (pageContainer) {
        this._createCurrentPage(pageContainer, browser.getUrl());
        this.currentPage.init();
    }
}

Site.prototype.setPage = function (url) {
    var self = this;

    if (self.currentPage) {
        if (self.currentPage.url == url)
            return;

        var isDeleted = self.currentPage.close();
        if (isDeleted)
            delete self.pages[self.currentPage.url];
    }

    browser.setTitle(require('params').site.title);

    self.currentPage = self.pages[url];
    if (self.currentPage) {
        self.currentPage.resume()
        return;
    }

    var p = self._createCurrentPage(
        $('<div>').hide().appendTo(self.el)[0],
        url
    );

    p.load();
}

Site.prototype._createCurrentPage = function (container, url) {
    return this.currentPage = this.pages[url] = new Page(container, url);
}
