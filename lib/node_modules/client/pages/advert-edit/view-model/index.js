var P = require('ports');
var Form = require('./form');
var Range = require('./range');

module.exports = Model;

Model.prototype = Object.create(Form.prototype);

Model.prototype.submit = function () {
    console.log(P.toJSON(this));
}

function Model (defaults) {
    this.name = Form.Field();
    this.level = Form.Field();
    this.description = Form.Field();
    this.rent = new Advert;
    this.sale = new Advert;
    this.hasError = P.computable(Form.hasError).mix(Form.skip);

    this.reset = function () {
        this.call('reset');
        P.setJSON(this, defaults);
    }

    P.setJSON(this, defaults);
}

function Advert () {
    this.available = Form.Field(false);
    this.space = Form.Field().mix(Range);
    this.price = Form.Field().mix(Range);
    this.hasError = P.computable(function () {
        return this.available() && (this.space.hasError() || this.price.hasError());
    }).mix(Form.skip);
}

